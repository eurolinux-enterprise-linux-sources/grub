From 85cf4ba771ea6a112f08206a6fb4c52fe3a1fdf6 Mon Sep 17 00:00:00 2001
From: =?UTF-8?q?V=C3=A1clav=20Pavl=C3=ADn?= <vpavlin@redhat.com>
Date: Thu, 10 Oct 2013 14:41:36 +0200
Subject: [PATCH] grub-install: Add support for NVMe to grub-install

Resolves: rhbz#1017296
---
 util/grub-install.in | 6 ++++--
 1 file changed, 4 insertions(+), 2 deletions(-)

diff --git a/util/grub-install.in b/util/grub-install.in
index c699413..bbf3b5e 100644
--- a/util/grub-install.in
+++ b/util/grub-install.in
@@ -109,7 +109,8 @@ convert () {
 				  -e 's%\(c[0-7]d[0-9]*\).*$%\1%' \
 	  -e 's%\(/mapper/[[:alpha:]]\+[[:digit:]]*\)p[[:digit:]]\+$%\1%' \
 	  -e 's%\(/mapper/isw_[[:alpha:]_]\+[[:alpha:]]\+[[:digit:]]\+\)p[[:digit:]]\+$%\1%' \
-	  -e 's%\(/mapper/[[:alpha:]]\+_[[:alpha:]]\+\)[[:digit:]]\+$%\1%'`
+	  -e 's%\(/mapper/[[:alpha:]]\+_[[:alpha:]]\+\)[[:digit:]]\+$%\1%' \
+          -e 's%\(nvme[0-9]*n[0-9]*\)p[0-9]*$%\1%'`
 	tmp_part=`echo "$1" | grep -v '/mapper/control$' |
 		grep -v '/mapper/[[:alnum:]]\+-[[:alnum:]]\+$' | uniq |
 		sed -e 's%.*/[shv]d[a-z]\([0-9]*\)$%\1%' \
@@ -120,7 +121,8 @@ convert () {
 				  -e 's%.*c[0-7]d[0-9]*%%' \
 	  -e 's%.*/mapper/[[:alpha:]]\+[[:digit:]]*p\([[:digit:]]\+\)$%\1%' \
 	  -e 's%.*/mapper/isw_[[:alpha:]_]\+[[:alpha:]]\+[[:digit:]]\+p\([[:digit:]]\+\)$%\1%' \
-	  -e 's%.*/mapper/[[:alpha:]]\+_[[:alpha:]]\+\([[:digit:]]\+\)$%\1%' |
+	  -e 's%.*/mapper/[[:alpha:]]\+_[[:alpha:]]\+\([[:digit:]]\+\)$%\1%' \
+          -e 's%.*/nvme[0-9]*n[0-9]*p\([0-9]*\)%\1%' |
 		grep -v '.*/mapper/.*'`
 	;;
     gnu*)
-- 
1.8.3.1

